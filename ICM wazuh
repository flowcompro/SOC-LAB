How to Use Wazuh to Check for Malware and Other Threats on a Host in a Network

Wazuh is an open-source security monitoring platform that provides comprehensive security information and event management (SIEM) capabilities. It can be used to detect malware, monitor integrity, and analyze vulnerabilities. Here's a step-by-step guide on how to set up and use Wazuh to check for malware and other threats on a host in a network.
Prerequisites

    A running instance of Wazuh Manager
    Wazuh Agent installed on the hosts you want to monitor
    Administrative access to the Wazuh dashboard
    Basic knowledge of Linux and networking

Step 1: Install and Configure Wazuh Manager

    Install Wazuh Manager:
        Follow the official Wazuh installation guide to install the Wazuh Manager on your server.
        Ensure that the manager is running and accessible.

    Configure Wazuh Manager:
        Modify the ossec.conf file located in the /var/ossec/etc/ directory to enable required modules and set appropriate configurations.

xml

<ossec_config>
  ...
  <wodle name="syscheck">
    <disabled>no</disabled>
    <frequency>43200</frequency>
    <directories check_all="yes" realtime="yes">/etc,/bin,/sbin,/usr/bin,/usr/sbin</directories>
    <ignore>/etc/mtab</ignore>
    <report_changes diff="yes">yes</report_changes>
  </wodle>
  ...
  <wodle name="rootcheck">
    <disabled>no</disabled>
    <frequency>43200</frequency>
  </wodle>
  ...
</ossec_config>

Step 2: Install and Configure Wazuh Agent

    Install Wazuh Agent:
        Follow the official Wazuh agent installation guide to install the agent on each host you want to monitor.

    Configure Wazuh Agent:
        Edit the ossec.conf file on each agent to connect it to the Wazuh Manager.
        Ensure the agent is running and able to communicate with the manager.

xml

<ossec_config>
  ...
  <client>
    <server>
      <address>MANAGER_IP</address>
      <port>1514</port>
    </server>
  </client>
  ...
</ossec_config>

Step 3: Enable Malware Detection Modules

    Enable the Rootcheck Module:
        Rootcheck performs rootkit and malware detection on the monitored hosts. Ensure it is enabled in the ossec.conf file on both the manager and agent.

xml

<ossec_config>
  ...
  <rootcheck>
    <enabled>yes</enabled>
    <frequency>43200</frequency>
  </rootcheck>
  ...
</ossec_config>

    Enable the Syscheck Module:
        Syscheck monitors file integrity and can detect changes indicative of malware. Ensure it is enabled and properly configured.

xml

<ossec_config>
  ...
  <syscheck>
    <enabled>yes</enabled>
    <frequency>43200</frequency>
    <directories check_all="yes">/etc,/bin,/sbin,/usr/bin,/usr/sbin</directories>
  </syscheck>
  ...
</ossec_config>

Step 4: Configure Malware Detection Rules

    Download and Configure YARA Rules:
        YARA rules can be used to identify malware by patterns. Download YARA rules from reputable sources and configure them in Wazuh.

xml

<ossec_config>
  ...
  <yara>
    <enabled>yes</enabled>
    <rules>/var/ossec/etc/rules.yar</rules>
  </yara>
  ...
</ossec_config>

    Update Wazuh Rules:
        Regularly update Wazuh rules to include the latest threat detection patterns. This can be done via the Wazuh dashboard or manually.

Step 5: Monitor and Respond to Threats

    Access the Wazuh Dashboard:
        Use the Wazuh dashboard to monitor alerts and logs generated by the agents.
        The dashboard provides a centralized view of all monitored hosts and detected threats.

    Analyze Alerts:
        Review alerts generated by the rootcheck and syscheck modules. Pay attention to high-severity alerts that indicate potential malware or system compromise.

    Respond to Threats:
        Investigate and respond to alerts by isolating affected hosts, removing malware, and taking corrective actions to secure the network.

Conclusion

By following these steps, you can effectively use Wazuh to monitor your network for malware and other security threats. Regularly update your configurations and rules to ensure your detection capabilities remain robust against evolving threats.
